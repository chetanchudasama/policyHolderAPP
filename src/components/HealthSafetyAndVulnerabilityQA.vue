<template>
    <div role="form" aria-label="Health safety and Vulnerability Question form">
    <div class="vulnerable-card-preview " v-if="localQA">
        <v-flex xs12>
              <h3> {{localQA.questionText}} </h3>
        </v-flex>
        <v-flex xs12>
          <v-radio-group
            @change="onSelectionChange()"
            v-model="localQA.isHealthAffected">
            <v-radio label="Yes" color="primary" :value="true" :disabled="isDisabled"/>
            <v-radio label="No" color="primary" :value="false" :disabled="isDisabled"/>
          </v-radio-group>
          <v-select v-if="localQA.level"    
            :items="getLevel"
            label="Level" 
            item-text="level" 
            item-value="id"  
            v-model="localQA.level"
            :disabled="isDisabled"
          ></v-select>
          <v-textarea v-if="localQA.isHealthAffected"              
            label="Details"
            v-model="localQA.answerDetail"
            :disabled="isDisabled"
          ></v-textarea>
        </v-flex>
    </div>
  </div>
</template>

<style scoped>
.processing-icon {
  animation-name: spin;
  animation-duration: 2000ms;
  animation-iteration-count: infinite;
  animation-timing-function: linear;
}
.vulnerable-card-preview >>> .progress-linear{position: absolute; bottom: -11px;}
@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}
</style>

<script lang="ts">
import { Component, Prop, Vue, Watch } from "vue-property-decorator";
import HealthAndSafetyQAModel from "@/models/claim/HealthAndSafetyQAModel";
import { Levels } from "@/common/enums";
import VulnerabilityQAModel from "@/models/claim/VulnerabilityQAModel";

interface IHealthAndSafetyLevel {
  id: string;
  level: string;
}

@Component({
  components: { },
})
export default class HealthSafetyAndVulnerabilityQA extends Vue {
  @Prop() private questionAnswer: HealthAndSafetyQAModel | VulnerabilityQAModel;
  @Prop({ default: false }) private isDisabled: boolean;
  private localQA: HealthAndSafetyQAModel | VulnerabilityQAModel | null = null;

  private mounted() {
      this.setLocalAnswer();
  }

  // set local answer as item of HealthAndSafetyQA or VulnerabilityQA
  private setLocalAnswer(): void {
    if (this.item) {
      this.localQA = {...this.item};
    }
  }

  private get item(): HealthAndSafetyQAModel | VulnerabilityQAModel {
    return this.questionAnswer;
  }

  private onSelectionChange(): void {
    if (!this.localQA) {
        return;
    }

    if (this.localQA.isHealthAffected && !this.localQA.level) {
        this.localQA.level = Levels[Levels.Low];
    }

    if (!this.localQA.isHealthAffected) {
        this.localQA.level = null;
        this.localQA.answerDetail = null;
    }
  }

  // bind dropdown for level from enum
  private get getLevel(): IHealthAndSafetyLevel[] {
    let keys: any[];
    const levelItems: IHealthAndSafetyLevel[] = [];

    if (this.item.type === 'HealthAndSafetyQA') {
      keys = Object.keys(Levels).filter(Number);
      keys.forEach((element) => {
          const entity: any = {};
          entity.id = Levels[element];
          entity.level = Levels[element];
          if (entity.level === "Low") {
            entity.level = "Low H&S Risk - Potential Risk of Injury";
          } else if (entity.level === "Medium") {
            entity.level = "Medium H&S Risk - Imminent Risk of Serious Injury";
          } else if (entity.level === "High") {
            entity.level = "High H&S Risk - Immediate Danger to Life";
          }
          levelItems.push(entity);
      });
    } else if (this.item.type === 'VulnerabilityQA') {
      keys = Object.keys(Levels).filter(Number);
      keys.forEach((element) => {
          const entity: any = {};
          entity.id = Levels[element];
          entity.level = Levels[element];
          levelItems.push(entity);
      });
    }

    return levelItems;
  }
}
</script>
